<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<p-toolbar>
  <div class="p-toolbar-group-start">
    <i class="pi pi-check-square" style="font-size: 1.5rem; margin-right: 0.5rem;"></i>
    <span class="font-bold text-xl">Gerenciador de Tarefas</span>
  </div>
  <div class="p-toolbar-group-end">
    <p-button label="Nova Tarefa" icon="pi pi-plus" (click)="abrirDialogParaNova()"></p-button>
  </div>
</p-toolbar>

<div class="card p-4">
  <p-table [value]="tarefas()" [tableStyle]="{ 'min-width': '50rem' }">
    <ng-template pTemplate="header">
      <tr>
        <th>Descrição</th><th style="width: 10rem;">Prioridade</th>
        <th style="width: 10rem;">Status</th><th style="width: 10rem;">Ações</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-tarefa>
      <tr>
        <td>{{ tarefa.descricao }}</td>
        <td><p-tag [severity]="getSeveridadePrioridade(tarefa.prioridade)" [value]="tarefa.prioridade"></p-tag></td>
        <td><p-tag [severity]="tarefa.concluida ? 'success' : 'warning'" [value]="tarefa.concluida ? 'Concluída' : 'Pendente'"></p-tag></td>
        <td>
          <p-button icon="pi pi-pencil" styleClass="p-button-sm p-button-info" (click)="abrirDialogParaEditar(tarefa)"></p-button>
          <p-button icon="pi pi-trash" styleClass="p-button-sm p-button-danger" class="ml-2" (click)="removerTarefa(tarefa)"></p-button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr><td colspan="4" class="text-center">Nenhuma tarefa encontrada.</td></tr>
    </ng-template>
  </p-table>
</div>

<p-dialog [header]="tituloDialog()" [(visible)]="dialogVisivel" [modal]="true" [style]="{ width: '50vw' }" [draggable]="false" [resizable]="false">
  <form [formGroup]="tarefaForm" (ngSubmit)="salvarTarefa()">
    <div class="field"><label for="descricao" class="font-semibold">Descrição</label><input pInputText id="descricao" formControlName="descricao" class="w-full mt-2" /></div>
    <div class="field mt-4"><label for="prioridade" class="font-semibold">Prioridade</label><p-dropdown id="prioridade" [options]="prioridades" formControlName="prioridade" class="w-full mt-2"></p-dropdown></div>
    <div class="field mt-4"><label for="concluida" class="font-semibold">Concluída</label><p-toggleButton id="concluida" formControlName="concluida" onLabel="Sim" offLabel="Não" class="w-full mt-2"></p-toggleButton></div>
    <div class="flex justify-content-end gap-2 mt-5">
      <p-button label="Cancelar" severity="secondary" (click)="dialogVisivel.set(false)"></p-button>
      <p-button type="submit" label="Salvar" [disabled]="tarefaForm.invalid"></p-button>
    </div>
  </form>
</p-dialog>

<router-outlet />